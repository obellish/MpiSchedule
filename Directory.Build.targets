<Project>
	<!-- See https://aka.ms/dotnet/msbuild/customize for more details on customizing your build -->
	<PropertyGroup Condition="$([MSBuild]::IsTargetFrameworkCompatible('$(TargetFramework)', 'net6.0'))">
		<IsTrimmable>true</IsTrimmable>
		<EnableTrimAnalyzer>true</EnableTrimAnalyzer>
		<EnableAotAnalyzer>true</EnableAotAnalyzer>
		<EnableSingleFileAnalyzer>true</EnableSingleFileAnalyzer>
	</PropertyGroup>

	<PropertyGroup Condition="$([MSBuild]::IsTargetFrameworkCompatible('$(TargetFramework)', 'net8.0'))">
		<IsAotCompatible>true</IsAotCompatible>
	</PropertyGroup>

	<PropertyGroup>
		<GeneratedSkipLocalsInitFile Condition="'$(GeneratedSkipLocalsInitFile)' == ''">$(IntermediateOutputPath)$(MSBuildProjectName).SkipLocalsInit.g.cs</GeneratedSkipLocalsInitFile>
		<GeneratedSkipLocalsInitFileLines>
			<![CDATA[//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

[module: global::System.Runtime.CompilerServices.SkipLocalsInitAttribute]]]>
		</GeneratedSkipLocalsInitFileLines>
	</PropertyGroup>

	<Target Name="GenerateSkipLocalsInit"
	        BeforeTargets="BeforeCompile;CoreCompile"
	        DependsOnTargets="PrepareForBuild"
	        Condition="'$(Language)' == 'C#'"
	        Inputs="$(MSBuildAllProjects)"
	        Outputs="$(GeneratedSkipLocalsInitFile)">

		<!-- Write the file with the attribute -->
		<WriteLinesToFile Lines="$(GeneratedSkipLocalsInitFileLines)" Overwrite="true" WriteOnlyWhenDifferent="true" File="$(GeneratedSkipLocalsInitFile)" />

		<!-- Include the generated file in the list of files to compile -->
		<ItemGroup>
			<Compile Include="$(GeneratedSkipLocalsInitFile)" />
		</ItemGroup>
	</Target>
</Project>